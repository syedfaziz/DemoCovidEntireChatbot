import json #to convert list and dictionary to json 
import os 
import requests 
from flask import Flask #it is microframework to develop a web app 
from flask import request
from flask import make_response

#Falsk app for our web app
app=Flask(__name__)

# app route decorator. when webhook is called, the decorator would call the functions which are e defined

# @app.route('/webhook', methods=['POST'])
@app.route('/', methods=['POST'])
def webhook(): 
	# convert the data from json. 
	req=request.get_json(silent=True, force=True) 
	# print(json.dumps(req, indent=4))
	#extract the relevant information and use api and get the response and send it dialogflow. 
	#helper function 
	res=makeResponse(req) 
	res=json.dumps(res, indent=4) 
	r=make_response(res) 
	r.headers['Content-Type']='application/json' 
	return r
	
# extract parameter values, query weahter api, construct the resposne 
def makeResponse(req): 
	result=req.get("queryResult")
	parameters=result.get("parameters") 
	# city=parameters.get("geo-city")
	# date=parameters.get("date")
	# r=requests.get('http://api.openweathermap.org/data/2.5/forecast?q=hyderabad,in&appid=db91df44baf43361cbf73026ce5156cb')
	# r = requests.get('http://api.openweathermap.org/data/2.5/forecast?q={},in&appid=db91df44baf43361cbf73026ce5156cb'.format(city))
	# json_object=r.json()
	# weather=json_object['list']


	# condition=weather[0]['weather'][0]['description']
	#speech="The forecast for "+city+ " for "+date+" is "+ condition
	#speech="data:image/png;base64,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"
	#return{ "fulfillmentMessages": [ { "text": { "text": [speech] } }]}
	#return{ "fulfillmentMessages": [ { "image": { "imageUri": [speech] } }]}
	#return{"fulfillmentMessages": [{"image": {"imageUri": "https://cdn.pixabay.com/photo/2015/06/19/21/24/the-road-815297__340.jpg"},"platform": "SLACK"}]}
	return({"fulfillmentMessages": [{"image": {"imageUri": "https://www.coywolf.news/wp-content/uploads/2020/03/coronaviruse.png"},"platform": "SLACK"},{"text": {"text": ["Hey there!!  \n I am your personal assistant and will assist you with details on covid-19. But before that I would like to have some information from you"]      },"platform": "SLACK"}]})



if __name__=='__main__':
	port=int(os.getenv('PORT',5000))
	print("starting on port %d" % port)
	app.run(debug=True, port=port, host='0.0.0.0')
	# app.run(port=5000, debug=True)